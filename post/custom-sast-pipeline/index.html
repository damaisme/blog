<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Custom SAST Pipeline | Damasukma Trihanandi</title><meta name=keywords content="Gitlab Administration"><meta name=description content="SAST dulunya adalah fitur dari gitlab ultimate, tapi sekarang dijadikan all tier tetapi terbatas dari segi fitur. Maka dari itu saya membuat tulisan ini untuk mengkostumisasi pipeline sast agar terasa ultimate."><meta name=author content="Damasukma Trihanandi"><link rel=canonical href=/post/custom-sast-pipeline/><link crossorigin=anonymous href=/assets/css/stylesheet.0b739a2e2c5e5656e4bcd5f0b2268d063addaf81d89ec3987d6af8f04decdc97.css integrity rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=apple-touch-icon href=apple-touch-icon.png><link rel=mask-icon href=safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-230159026-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Custom SAST Pipeline"><meta property="og:description" content="SAST dulunya adalah fitur dari gitlab ultimate, tapi sekarang dijadikan all tier tetapi terbatas dari segi fitur. Maka dari itu saya membuat tulisan ini untuk mengkostumisasi pipeline sast agar terasa ultimate."><meta property="og:type" content="article"><meta property="og:url" content="/post/custom-sast-pipeline/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-07-08T14:11:15+07:00"><meta property="article:modified_time" content="2022-07-08T14:11:15+07:00"><meta property="og:site_name" content="Damasukma Trihanandi - Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Custom SAST Pipeline"><meta name=twitter:description content="SAST dulunya adalah fitur dari gitlab ultimate, tapi sekarang dijadikan all tier tetapi terbatas dari segi fitur. Maka dari itu saya membuat tulisan ini untuk mengkostumisasi pipeline sast agar terasa ultimate."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/post/"},{"@type":"ListItem","position":3,"name":"Custom SAST Pipeline","item":"/post/custom-sast-pipeline/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Custom SAST Pipeline","name":"Custom SAST Pipeline","description":"SAST dulunya adalah fitur dari gitlab ultimate, tapi sekarang dijadikan all tier tetapi terbatas dari segi fitur. Maka dari itu saya membuat tulisan ini untuk mengkostumisasi pipeline sast agar terasa ultimate.","keywords":["Gitlab Administration"],"articleBody":"Limitasi Gitlab Saat menggunakan default template sast yaitu SAST.gitlab-ci.yml template, ditemukanya vulnerability atau tidak status job nya pasti akan passed yang menyebabkan pipeline akan terus berjalan walupun ditemukan bug. Jika menginginkan fitur lebih seperti detect false positives, sort and manage vulnabilitier, dan lain2 kita harus upgrade gitlab ke ultimate.\nDi tulisan kali in kita akan mencoba membuat dan mengkostumisasi job yang akan mengecek content dari report analyzer. How it is achieved:\njob SAST analyzer menghasilkan report/artifacts job selanjutnya akan mengecek report sehingga jika ada bug/vulnerability ditemukan, maka pipeline akan gagal. Custom SAST Pipeline Buat project baru dari template Pilih tempalte nodejs express Create Project\nBuka Web IDE, buat dan edit .gitlab-ci.yml; buat job yang menjalakan nodejs-scan analyzer.\n# tidak perlu include template sast karena job dibuat manual stages: - test nodejs-scan-sast: image: registry.gitlab.com/security-products/sast/nodejs-scan:2 # image nodejs-scan-sast stage: test # job dijalankan di test stage artifacts: paths: - gl-sast-report.json # supaya json report bisa diakses di next job script: - /analyzer run gl-sast-report.json ini adalah nama file report, semua analyzer image sama.\nTambahkan job sast-vuln, job ini yang akan ngecek hasil report dari job nodejs-scan-sast. ... sast-vuln: stage: test needs: - nodejs-scan-sast image: python:3-slim script: - python3 check_vuln.py # Menjalankan script python yang akan menganisis gl-sast-report.json di gitlab ci ada special keyword needs dimana keyword ini akan membuat dependencies diantara job, dan membuat job hanya dapat berjalan jika dependent job complete. pada kasus ini sast-vuln hanya dapat berjalan jika nodejs-scan-sast passed.\nDi atas ada menjalankan script python, bingung? sans… bakal dibahas di bawah.\nTambahkan stage dan job deploy. Stage dan job ini hanya untuk simulasi, yang hanya akan berjalan jika job di test stage passed. stages: - test - deploy #deploy stage hanya akan berjalan jika test stage passed. ... deploy-job: stage: deploy script: - echo \"deploy successfull\" Maka full .gitlab-ci.yml jadi seperti di bawah ini # tidak perlu include template sast karena job dibuat manual stages: - test - deploy #deploy stage hanya akan berjalan jika test stage passed. nodejs-scan-sast: image: registry.gitlab.com/security-products/sast/nodejs-scan:2 # image nodejs-scan-sast stage: test # job dijalankan di test stage artifacts: paths: - gl-sast-report.json # supaya json report bisa diakses di next job script: - /analyzer run sast-vuln: stage: test needs: - nodejs-scan-sast image: python:3-slim script: - python3 check_vuln.py # Menjalankan script python yang akan menganisis gl-sast-report.json deploy-job: stage: deploy script: - echo \"deploy successfull\" Buat file baru check_vuln.py import sys import json with open('gl-sast-report.json') as json_file: report = json.load(json_file) if ( len(report['vulnerabilities']) != 1 ): print(\"No Vulnerabilities Detected\") else: print(\"Vulnerabilities detected\") for x in report['vulnerabilities']: pretty_json = json.dumps(x, indent=4) print(pretty_json) sys.exit(1) Ini script checker yang akan mengecek json report dan akan memberi return error jka ada vulnerability ditemukan. Hal ini akan membuat pipeline failed, hingga bug difix.\ncheck_vuln.py bekerja seperti berikut:\ndecoding JSON Report file ke Python Dictionary yang berisi data dari analyzer terkait vulnerabilities; printing setiap vulnerability jika ada, menggunakan pretty json formatted. atau bisa juga diberi warna, dijadiin table, dll untuk tujuan visualisasi; return error jika length array vulnerabilities tidak 0. untuk pengecekan report bisa menggunakan pemprograman apapun, disini menggukana python hanya sebagai contoh agar mudah.\nPipeline selesai, sekarang tambahkan bug ke code kita untuk simulasi. Edit file routes/users.js jadi seperti dibawah. var express = require('express'); var router = express.Router(); /* GET users listing. */ router.get('/', function(req, res, next) { res.send('hello',req.params.name); }); module.exports = router; Commit semua perubahan ke current branch, ini akan menjalankan pipeline.\nBuka CI/CD Pipeline page dan bisa dilihat job sast-vuln berstatus failed dan deploy stage tidak dijalankan. Karena ada bug ditemukan. Click di sast-vuln job, di log terdapat detail dari vulnerabilities. disini terdapat satu vuln bernama express_xss dengan severity high di file routes/users.js line 6, ini adalah vuln yang kita buat sebelumnya. Sekarang kita coba fix bugnya, buka Web IDE lalu edit routes/users.js, edit line 6 menjadi seperti ini:\nres.send('hello'); Save lalu commit ke current branch\nBuka CI/CD Pipeline page. Sekarang job sast-vuln passed dan deploy stage dijalankan. Pipeline sekarang dapat memberikan feedback error jika ada bug ditemukan.\nKesimpulan: SAST adalah tools yang lumayan berguna saat menerapkan ci/cd di gitlab dan disarankan untuk dijalankan di test stage untuk mendeteksi bug dari source code. Berapa fitur SAST Gitlab harus upgrade tier ke ultimate dulu untuk bisa digunakan. Tetapi terdapat berbagai cara untuk mencapai tujuan yang sama.\n","wordCount":"705","inLanguage":"en","datePublished":"2022-07-08T14:11:15+07:00","dateModified":"2022-07-08T14:11:15+07:00","author":{"@type":"Person","name":"Damasukma Trihanandi"},"mainEntityOfPage":{"@type":"WebPage","@id":"/post/custom-sast-pipeline/"},"publisher":{"@type":"Organization","name":"Damasukma Trihanandi","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="DT (Alt + H)">DT</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/ title=Home><span>Home</span></a></li><li><a href=/categories/ title=Categories><span>Categories</span></a></li><li><a href=/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dendi.ninja title=About><span>About</span></a></li><li><a href=/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Custom SAST Pipeline</h1><div class=post-description>SAST dulunya adalah fitur dari gitlab ultimate, tapi sekarang dijadikan all tier tetapi terbatas dari segi fitur. Maka dari itu saya membuat tulisan ini untuk mengkostumisasi pipeline sast agar terasa ultimate.</div><div class=post-meta><span title='2022-07-08 14:11:15 +0700 +07'>July 8, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Damasukma Trihanandi&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/custom-sast-pipeline.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h3 id=limitasi-gitlab>Limitasi Gitlab<a hidden class=anchor aria-hidden=true href=#limitasi-gitlab>#</a></h3><p>Saat menggunakan default template sast yaitu SAST.gitlab-ci.yml template, ditemukanya vulnerability atau tidak status job nya pasti akan passed yang menyebabkan pipeline akan terus berjalan walupun ditemukan bug. Jika menginginkan fitur lebih seperti detect false positives, sort and manage vulnabilitier, dan lain2 kita harus upgrade gitlab ke ultimate.</p><p>Di tulisan kali in kita akan mencoba membuat dan mengkostumisasi job yang akan mengecek content dari report analyzer. How it is achieved:</p><ul><li>job SAST analyzer menghasilkan report/artifacts</li><li>job selanjutnya akan mengecek report sehingga jika ada bug/vulnerability ditemukan, maka pipeline akan gagal.</li></ul><h3 id=custom-sast-pipeline>Custom SAST Pipeline<a hidden class=anchor aria-hidden=true href=#custom-sast-pipeline>#</a></h3><ol><li><p>Buat project baru dari template
<img loading=lazy src=/img/custom-sast-pipeline/create-from-template.png alt></p></li><li><p>Pilih tempalte nodejs express
<img loading=lazy src=/img/custom-sast-pipeline/nodejs-template.png alt></p></li><li><p>Create Project</p></li><li><p>Buka Web IDE, buat dan edit .gitlab-ci.yml;
buat job yang menjalakan nodejs-scan analyzer.</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># tidak perlu include template sast karena job dibuat manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>nodejs-scan-sast</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>registry.gitlab.com/security-products/sast/nodejs-scan:2</span><span class=w> </span><span class=c># image nodejs-scan-sast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w> </span><span class=c># job dijalankan di test stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>gl-sast-report.json</span><span class=w> </span><span class=c># supaya json report bisa diakses di next job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/analyzer run</span><span class=w>
</span></span></span></code></pre></div><p>gl-sast-report.json ini adalah nama file report, semua analyzer image sama.</p><ol start=5><li>Tambahkan job sast-vuln,
job ini yang akan ngecek hasil report dari job nodejs-scan-sast.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>sast-vuln</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>needs</span><span class=p>:</span><span class=w>                                
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nodejs-scan-sast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>python:3-slim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>python3 check_vuln.py</span><span class=w> </span><span class=c># Menjalankan script python yang akan menganisis gl-sast-report.json</span><span class=w>
</span></span></span></code></pre></div><p>di gitlab ci ada special keyword <code>needs</code> dimana keyword ini akan membuat dependencies diantara job, dan membuat job hanya dapat berjalan jika dependent job complete. pada kasus ini sast-vuln hanya dapat berjalan jika nodejs-scan-sast passed.</p><p>Di atas ada menjalankan script python, bingung? sans&mldr; bakal dibahas di bawah.</p><ol start=6><li>Tambahkan stage dan job deploy.
Stage dan job ini hanya untuk simulasi, yang hanya akan berjalan jika job di test stage passed.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w> </span><span class=c>#deploy stage hanya akan berjalan jika test stage passed.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;deploy successfull&#34;</span><span class=w>
</span></span></span></code></pre></div><ol start=7><li>Maka full .gitlab-ci.yml jadi seperti di bawah ini</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># tidak perlu include template sast karena job dibuat manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w> </span><span class=c>#deploy stage hanya akan berjalan jika test stage passed.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>nodejs-scan-sast</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>registry.gitlab.com/security-products/sast/nodejs-scan:2</span><span class=w> </span><span class=c># image nodejs-scan-sast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w> </span><span class=c># job dijalankan di test stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>gl-sast-report.json</span><span class=w> </span><span class=c># supaya json report bisa diakses di next job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/analyzer run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>sast-vuln</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>needs</span><span class=p>:</span><span class=w>                                
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nodejs-scan-sast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>python:3-slim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>python3 check_vuln.py</span><span class=w> </span><span class=c># Menjalankan script python yang akan menganisis gl-sast-report.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;deploy successfull&#34;</span><span class=w>
</span></span></span></code></pre></div><ol start=8><li>Buat file baru check_vuln.py</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;gl-sast-report.json&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>json_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>report</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>json_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=nb>len</span><span class=p>(</span><span class=n>report</span><span class=p>[</span><span class=s1>&#39;vulnerabilities&#39;</span><span class=p>])</span> <span class=o>!=</span> <span class=mi>1</span> <span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;No Vulnerabilities Detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Vulnerabilities detected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>report</span><span class=p>[</span><span class=s1>&#39;vulnerabilities&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>pretty_json</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>pretty_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>Ini script checker yang akan mengecek json report dan akan memberi return error jka ada vulnerability ditemukan. Hal ini akan membuat pipeline failed, hingga bug difix.</p><p>check_vuln.py bekerja seperti berikut:</p><ul><li>decoding JSON Report file ke Python Dictionary yang berisi data dari analyzer terkait vulnerabilities;</li><li>printing setiap vulnerability jika ada, menggunakan pretty json formatted. atau bisa juga diberi warna, dijadiin table, dll untuk tujuan visualisasi;</li><li>return error jika length array vulnerabilities tidak 0.</li></ul><blockquote><p>untuk pengecekan report bisa menggunakan pemprograman apapun, disini menggukana python hanya sebagai contoh agar mudah.</p></blockquote><ol start=9><li>Pipeline selesai, sekarang tambahkan bug ke code kita untuk simulasi. Edit file routes/users.js jadi seperti dibawah.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* GET users listing. */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>router</span><span class=p>;</span>
</span></span></code></pre></div><ol start=10><li><p>Commit semua perubahan ke current branch, ini akan menjalankan pipeline.</p></li><li><p>Buka CI/CD Pipeline page dan bisa dilihat job sast-vuln berstatus failed dan deploy stage tidak dijalankan. Karena ada bug ditemukan.
<img loading=lazy src=/img/custom-sast-pipeline/failed-pipeline.png alt></p></li><li><p>Click di sast-vuln job, di log terdapat detail dari vulnerabilities. disini terdapat satu vuln bernama express_xss dengan severity high di file routes/users.js line 6, ini adalah vuln yang kita buat sebelumnya.
<img loading=lazy src=/img/custom-sast-pipeline/failed-sast-vuln.png alt></p></li><li><p>Sekarang kita coba fix bugnya, buka Web IDE lalu edit routes/users.js, edit line 6 menjadi seperti ini:</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>Save lalu commit ke current branch</p><ol start=14><li><p>Buka CI/CD Pipeline page.
Sekarang job sast-vuln passed dan deploy stage dijalankan.
<img loading=lazy src=/img/custom-sast-pipeline/sast-vuln-passed.png alt></p></li><li><p>Pipeline sekarang dapat memberikan feedback error jika ada bug ditemukan.</p></li></ol><h3 id=kesimpulan>Kesimpulan:<a hidden class=anchor aria-hidden=true href=#kesimpulan>#</a></h3><p>SAST adalah tools yang lumayan berguna saat menerapkan ci/cd di gitlab dan disarankan untuk dijalankan di test stage untuk mendeteksi bug dari source code. Berapa fitur SAST Gitlab harus upgrade tier ke ultimate dulu untuk bisa digunakan. Tetapi terdapat berbagai cara untuk mencapai tujuan yang sama.</p></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/gitlab-administration/>Gitlab Administration</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Custom SAST Pipeline on twitter" href="https://twitter.com/intent/tweet/?text=Custom%20SAST%20Pipeline&url=%2fpost%2fcustom-sast-pipeline%2f&hashtags=GitlabAdministration"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Custom SAST Pipeline on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=%2fpost%2fcustom-sast-pipeline%2f&title=Custom%20SAST%20Pipeline&summary=Custom%20SAST%20Pipeline&source=%2fpost%2fcustom-sast-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Custom SAST Pipeline on reddit" href="https://reddit.com/submit?url=%2fpost%2fcustom-sast-pipeline%2f&title=Custom%20SAST%20Pipeline"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Custom SAST Pipeline on facebook" href="https://facebook.com/sharer/sharer.php?u=%2fpost%2fcustom-sast-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Custom SAST Pipeline on whatsapp" href="https://api.whatsapp.com/send?text=Custom%20SAST%20Pipeline%20-%20%2fpost%2fcustom-sast-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Custom SAST Pipeline on telegram" href="https://telegram.me/share/url?text=Custom%20SAST%20Pipeline&url=%2fpost%2fcustom-sast-pipeline%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright &copy; 2022 <a href>Damasukma Trihanandi</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>